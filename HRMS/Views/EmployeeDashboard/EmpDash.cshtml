@model HRMS.Models.Employee.EmpDashBoardModel


@{
    var loginID = 0;
    var buttonText = "Check-In";
    DateTime checkInTime = DateTime.MinValue;
    DateTime? checkOutTime = DateTime.MinValue;

    string starttimeWithAmPm = "";
    string endtimeWithAmPm = "";

    if (Model.CheckInInfo != null && Model.CheckInInfo.login_id != 0)
    {
        loginID = Model.CheckInInfo.login_id;
        buttonText = "Check-Out";
        checkInTime = Model.CheckInInfo.Signin_Time;
        checkOutTime = Model.CheckInInfo.Signout_Time;

        starttimeWithAmPm = checkInTime.ToString("hh:mm tt", System.Globalization.CultureInfo.InvariantCulture);
        endtimeWithAmPm = checkOutTime?.ToString("hh:mm tt", System.Globalization.CultureInfo.InvariantCulture);

    }
}
<div class="container-fluid mt-4 ml-4 employeedash">
    <h4>Dashboard</h4>
    <div class="row mt-4">
        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-header text-dark">Check In / Check Out</div>
                <div class="card-body chechin-body" style="padding: 1rem;">
                    <div class="day-date-time ml-2 mt-3">
                        <h5 id="day"></h5> <!-- Display day here -->
                        <div id="currentDate" class="time-input"></div> <!-- Replace input with div -->
                        <div id="currentTime" class="current-time mb-2"></div> <!-- Replace input with div -->
                    </div>

                    <div class="in-out mr-4 mt-3">
                        <div class="check-time">
                            <span class="check-label">Check In time:</span>
                            <div id="checkInTime" class="time-input" style="color: blue">@starttimeWithAmPm</div> <!-- Replace input with div -->
                        </div>
                        <div class="check-time mt-2">
                            <span class="check-label">Check Out time:</span>
                            <div id="checkOutTime" class="time-input">@endtimeWithAmPm</div> <!-- Replace input with div -->
                        </div>
                    </div>

                    <div class="current-time-display text-center">
                        <div id="currentTime" class="current-time"></div>
                    </div>

                    <div class="button-container text-left">
                        <button class="btn btn-checkin" data-checkinid="@loginID">@buttonText</button>
                    </div>
                </div>
            </div>
            <div class="card mb-3">
                <div class="card-header text-dark">Job Referral</div>
                <div class="card-body" style="padding:1rem;">
                    <p>Interior Designer <br> Location: Bangalore | Posted on: 10/05/2024</p>
                    <p>Business Analyst <br> Location: Madurai | Posted on: 10/05/2024</p>
                    <p>Jr. IT Recruiter <br> Location: Madurai | Posted on: 10/05/2024</p>
                </div>
            </div>
            <div class="card mb-3">
                <div class="card-header text-black">My Tickets</div>
                <div class="card-body" style="padding: 1rem;">
                    <p>System Not working <span class="badge badge-danger">High</span></p>
                    <p><small>Closed by Goutham Arunaigiri</small></p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-header text-dark">Birthdays</div>
                <div class="card-body" style="max-height: 222px; overflow-y: auto; padding:1rem; height:221px;">
                    @if (!Model.BirthModel?.Any() ?? true)
                    {
                        <div class="d-flex flex-column align-items-center justify-content-center">
                            <img src="~/Assets/Birthday.png" alt="No Birthdays" class="img-fluid mb-3" style="max-width: 133px;">
                            <p class="text-muted">No birthdays today</p>
                        </div>
                    }
                    else
                    {
                        <ul class="list-unstyled">
                            @foreach (var empBirthday in Model.BirthModel)
                            {
                                var empImageURl = System.Configuration.ConfigurationManager.AppSettings["EmpImagesFolder"] + "/" + empBirthday.imagePath;

                                <li class="media mb-3">
                                    <img src="@empImageURl" class="mr-3 rounded-circle" alt="Avatar" style="width: 50px; height: 50px;">
                                    <div class="media-body">
                                        <h5 class="mt-0 mb-1 empname">@empBirthday.EmpName</h5>
                                        <p><small>@empBirthday.Designation</small></p>
                                    </div>
                                    @*<div class="align-self-center">
                                        <input type="radio" name="selectedEmployee" value="@empBirthday.Empid">
                                    </div>*@

                                    <small style="display: none" class="empemail">@empBirthday.EmpEmail</small>
                                </li>
                            }
                        </ul>
                    }

                    @*@if (Model.BirthModel?.Any() ?? true)
        {
            <hr>
            <div class="d-flex justify-content-between align-items-center">
                <span class="text-success" style="cursor: pointer;" onclick="sendWishes()">Send them best wishes</span>
                <i class="fas fa-paper-plane text-success" style="cursor: pointer;" onclick="sendWishes()"></i>
            </div>
        }*@
                </div>
            </div>




            <div class="card mb-3">
                <div class="card-header text-dark">Anniversaries</div>
                <div class="card-body" style="max-height: 243px; overflow-y: auto; padding: 1rem; height: 226px;">
                    <!-- Anniversary Body starts here using carousel -->
                    <div id="cardCarousel" class="carousel slide" data-ride="carousel">
                        <div class="carousel-inner1">
                            @if (!Model.AnniversaryModel?.Any() ?? true)
                            {
                              <div class="d-flex flex-column align-items-center justify-content-center">
                                <img src="~/Assets/WorkAnni.jpg" alt="No Birthdays" class="img-fluid mb-3" style="max-width: 135px;">
                                <p class="text-muted">No anniversaries today.</p>
                              </div>
                             }
                             else
                                    {
                                    foreach (var employeeAnniversary in Model.AnniversaryModel)
                                    {
                                    var empImageURl = System.Configuration.ConfigurationManager.AppSettings["EmpImagesFolder"] + "/" + @employeeAnniversary.imagePath;

                                    <div class="carousel-item @(employeeAnniversary == Model.AnniversaryModel.First() ? "active" : "")">
                                        <div class="d-flex">
                                            <div class="card anniver_card mb-2" style="border:none;">
                                                <div class="card-body d-flex p-0">
                                                    <img src="@empImageURl" class="mr-3 rounded-circle" alt="Avatar" style="width: 50px; height: 50px;">
                                                    <div class="media-body">
                                                        <h5 class="mt-0 mb-1">@employeeAnniversary.EmpName</h5>
                                                        <p><small>@employeeAnniversary.Designation</small></p>
                                                        <p class="text-primary">Successfully Completed @employeeAnniversary.years Years</p>
                                                        <p class="d-none email">@employeeAnniversary.EmpEmail</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    }
                                    }
                                </div>

                                @*@if (Model.AnniversaryModel?.Any() ?? true)
            {
                <a class="carousel-control-next" href="#cardCarousel" role="button" data-slide="next">
                    <i class="fa-solid fa-chevron-right"></i>
                    <span class="sr-only">Next</span>
                </a>
            }*@
                            </div>
                    <!-- The wish sending box code -->
                    @*@if (Model.AnniversaryModel?.Any() ?? true)
                    {
                        <hr />
                        <div class="d-flex justify-content-between align-items-center mt-4">
                            <span class="text-success" style="cursor: pointer;" onclick="sendAnniversaryWishes()">Send them best wishes</span>
                            <i class="fas fa-paper-plane text-success" style="cursor: pointer;" onclick="sendAnniversaryWishes()"></i>
                        </div>
                    }*@
                </div>
            </div>

            <div class="card mb-3">
                <div class="card-header text-dark">Employee Handbook</div>
                <div class="card-body" style="padding:1rem;">
                    <p>jkflkasdjgoifsdjglknasflkgnashgoisajglksajgkljfsa;lkgjisfhgafsgklsfaklgjaslgasklj;hjkhjkhluhjkbjkkjhkjhkjhuhkj</p>
                    <button class="btn btn-secondary">View Handbook</button>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card mb-3">

                <div class="card-header calendar-header text-dark">
                    <div>
                        <i class="fas fa-chevron-left chevron-icon ml-4" onclick="prevMonth()"></i>
                    </div>
                    <div>
                        <h6 id="monthYear" class="mt-1"></h6>
                    </div>
                    <div>
                        <i class="fas fa-chevron-right chevron-icon mr-4" onclick="nextMonth()"></i>
                    </div>
                </div>
                <div class="card-body calendar-body"  style="padding: 1rem;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th scope="col">Mon</th>
                                <th scope="col">Tue</th>
                                <th scope="col">Wed</th>
                                <th scope="col">Thu</th>
                                <th scope="col">Fri</th>
                                <th scope="col">Sat</th>
                                <th scope="col">Sun</th>
                            </tr>
                        </thead>
                        <tbody id="calendarBody"></tbody>
                    </table>
                </div>
            </div>


            <div class="card mb-3">
                <div class="card-header text-dark">Upcoming Holidays</div>
                <div class="card-body" style="max-height: 300px; overflow-y: auto; ">
                    <ul class="list-unstyled" style="padding-left: 0;">
                        @foreach (HRMS.Models.Employee.UpcomingHoliday holiday in Model.UpcomingHolidays)
                        {
                            if (@holiday.HolidayDate != DateTime.MinValue)
                            {
                                <li style="padding-bottom: 10px;">
                                    <h6 style="margin-bottom: 0; font-size: 14px;">@holiday.HolidayName</h6>
                                    <small>@holiday.HolidayDate.ToString("dd MMMM dddd")</small>
                                </li>
                            }
                        }

                    </ul>
                </div>
            </div>
        </div>
        <div class="col-md-8">
            <div class="card mb-3">                
                    <div class="box_topic pl-3 py-2">
                        Leaves
                    </div>
                    <!------Body of Calendar starts here------>
                    <div class="card-body box_body">
                        <div class="container text-center my-3 leave_container">
                            <div class="row mx-auto my-auto">
                                <div id="recipeCarousel" class="carousel slide w-100" data-ride="carousel">
                                    <div class="carousel-inner w-100" role="listbox">
                                        <div class="carousel-item active">
                                            <div class="col-md-3 m-0">
                                                <div class="card card-body leave-card">
                                                    <div class="leave-icon bg-bereavement">BL</div>
                                                    <h6 class="leave-title">Bereavement Leave</h6>
                                                    <p class="leave-details">Available: 2</p>
                                                    <p class="leave-details">Booked: 1</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="carousel-item">
                                            <div class="col-md-3 m-0">
                                                <div class="card card-body leave-card">
                                                    <div class="leave-icon bg-compensatory">CL</div>
                                                    <h6 class="leave-title">Compensatory Off</h6>
                                                    <p class="leave-details">Available: 0</p>
                                                    <p class="leave-details">Booked: 0</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="carousel-item">
                                            <div class="col-md-3 m-0">
                                                <div class="card card-body leave-card">
                                                    <div class="leave-icon bg-earned">EL</div>
                                                    <h6 class="leave-title">Earned Leave-Full Time</h6>
                                                    <p class="leave-details">Available: 14</p>
                                                    <p class="leave-details">Booked: 3</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="carousel-item">
                                            <div class="col-md-3 m-0">
                                                <div class="card card-body leave-card">
                                                    <div class="leave-icon bg-emergency">EL</div>
                                                    <h6 class="leave-title">Emergency Leave</h6>
                                                    <p class="leave-details">Available: 3</p>
                                                    <p class="leave-details">Booked: 1</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="carousel-item">
                                            <div class="col-md-3 m-0">
                                                <div class="card card-body leave-card">
                                                    <div class="leave-icon bg-danger">SL</div>
                                                    <h6 class="leave-title">Sick Leave</h6>
                                                    <p class="leave-details">Available: 5</p>
                                                    <p class="leave-details">Booked: 2</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="carousel-item">
                                            <div class="col-md-3 m-0">
                                                <div class="card card-body leave-card">
                                                    <div class="leave-icon bg-secondary">PL</div>
                                                    <h6 class="leave-title">Personal Leave</h6>
                                                    <p class="leave-details">Available: 4</p>
                                                    <p class="leave-details">Booked: 1</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="carousel-item">
                                            <div class="col-md-3 m-0">
                                                <div class="card card-body leave-card">
                                                    <div class="leave-icon bg-marriage">ML</div>
                                                    <h6 class="leave-title">Marriage Leave</h6>
                                                    <p class="leave-details">Available: 5</p>
                                                    <p class="leave-details">Booked: 1</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="carousel-item">
                                            <div class="col-md-3 m-0">
                                                <div class="card card-body leave-card">
                                                    <div class="leave-icon bg-paternity">PL</div>
                                                    <h6 class="leave-title">Paternity Leave</h6>
                                                    <p class="leave-details">Available: 10</p>
                                                    <p class="leave-details">Booked: 2</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="carousel-item">
                                            <div class="col-md-3 m-0">
                                                <div class="card card-body leave-card">
                                                    <div class="leave-icon bg-maternity">ML</div>
                                                    <h6 class="leave-title">Maternity Leave</h6>
                                                    <p class="leave-details">Available: 12</p>
                                                    <p class="leave-details">Booked: 4</p>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                    <a class="carousel-control-prev" href="#recipeCarousel" role="button" data-slide="prev">
                                        <i class="fa-solid fa-chevron-left"></i>
                                        <span class="sr-only">Previous</span>
                                    </a>
                                    <a class="carousel-control-next " href="#recipeCarousel" role="button" data-slide="next">
                                        <i class="fa-solid fa-chevron-right"></i>
                                        <span class="sr-only">Next</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
        </div>
    </div>

        <span class="currentempname" style="display: none">@Model.EmpInfo.EmployeeName</span>


    <script>

        if ($('.isempdashboardloaded').text() == "false") {
            let currentMonth;
            let currentYear;

            // Define festivals
            const festivals = {
                '1-1': 'New Year',
                '12-25': 'Christmas',
                '10-2': 'Gandhi Jayanti',
                // Add more festivals here as needed
            };

            function updateCalendar() {
                generateCalendar(currentMonth, currentYear);
            }

            function generateCalendar(month, year) {
                const today = new Date();
                const firstDayOfMonth = new Date(year, month, 1);
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const startingDay = firstDayOfMonth.getDay() === 0 ? 6 : firstDayOfMonth.getDay() - 1;

                const calendarBody = document.getElementById("calendarBody");
                calendarBody.innerHTML = "";

                document.getElementById("monthYear").innerText = new Date(year, month).toLocaleDateString('default', { month: 'long', year: 'numeric' });

                let date = 1;
                for (let i = 0; i < 6; i++) {
                    const row = document.createElement("tr");

                    for (let j = 0; j < 7; j++) {
                        if (i === 0 && j < startingDay) {
                            const cell = document.createElement("td");
                            row.appendChild(cell);
                        } else if (date > daysInMonth) {
                            break;
                        } else {
                            const cell = document.createElement("td");
                            cell.textContent = date;
                            const festivalKey = `${month + 1}-${date}`;
                            if (date === today.getDate() && year === today.getFullYear() && month === today.getMonth()) {
                                cell.classList.add("highlight-current");
                                const todayTooltip = document.createElement("div");
                                todayTooltip.classList.add("today-tooltip");
                                todayTooltip.textContent = "Today";
                                cell.appendChild(todayTooltip);
                            } else if (festivals[festivalKey]) {
                                cell.dataset.festival = festivals[festivalKey];
                                cell.classList.add("highlight-festival");
                                const festivalTooltip = document.createElement("div");
                                festivalTooltip.classList.add("festival-tooltip");
                                festivalTooltip.textContent = festivals[festivalKey];
                                cell.appendChild(festivalTooltip);
                            }
                            row.appendChild(cell);
                            date++;
                        }
                    }

                    calendarBody.appendChild(row);
                }
            }

            function prevMonth() {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                updateCalendar();
            }

            function nextMonth() {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                updateCalendar();
            }

            // Initialize current month and year
            const currentDate = new Date();
            currentMonth = currentDate.getMonth();
            currentYear = currentDate.getFullYear();
            generateCalendar(currentMonth, currentYear);

            var lastAction = "checkIn";
            var lastDate = null;

            function toggleCheck() {
                if (lastAction === "checkIn") {
                    // Perform check-in
                    var currentDate = new Date();
                    var hours = currentDate.getHours();
                    var minutes = currentDate.getMinutes().toString().padStart(2, '0');
                    var seconds = currentDate.getSeconds().toString().padStart(2, '0');

                    var ampm = hours >= 12 ? 'PM' : 'AM';
                    hours = hours % 12;
                    hours = hours ? hours : 12; // Handle midnight (0 hours)

                    var currentTime = hours.toString().padStart(2, '0') + ":" + minutes + ":" + seconds;
                    document.getElementById("checkInTime").textContent = currentTime;
                    lastAction = "checkOut";
                    document.querySelector("button").textContent = "Check-Out";
                } else {
                    // Perform check-out
                    var currentDate = new Date();
                    var hours = currentDate.getHours();
                    var minutes = currentDate.getMinutes().toString().padStart(2, '0');
                    var seconds = currentDate.getSeconds().toString().padStart(2, '0');

                    var ampm = hours >= 12 ? 'PM' : 'AM';
                    hours = hours % 12;
                    hours = hours ? hours : 12; // Handle midnight (0 hours)

                    var currentTime = hours.toString().padStart(2, '0') + ":" + minutes + ":" + seconds;
                    document.getElementById("checkOutTime").textContent = currentTime;
                    lastAction = "checkIn";
                    document.querySelector("button").textContent = "Check-In";
                }
            }


            function updateRunningTime() {
                var currentDate = new Date();
                var hours = currentDate.getHours();
                var minutes = currentDate.getMinutes().toString().padStart(2, '0');
                var seconds = currentDate.getSeconds().toString().padStart(2, '0');

                var ampm = hours >= 12 ? 'PM' : 'AM';
                hours = hours % 12;
                hours = hours ? hours : 12; // Handle midnight (0 hours)

                var currentTime = hours.toString().padStart(2, '0') + ":" + minutes + ":" + seconds + " " + ampm;

                document.getElementById("currentDate").textContent = currentDate.toLocaleDateString('en-IN', { timeZone: 'Asia/Kolkata', year: 'numeric', month: 'long', day: 'numeric' });
                document.getElementById("currentTime").textContent = currentTime;
                document.getElementById("day").textContent = currentDate.toLocaleDateString('en-IN', { timeZone: 'Asia/Kolkata', weekday: 'long' }).toUpperCase() + ",";
            }

            //// Ensure the DOM is fully loaded before setting up the interval
            //window.onload = function () {
            // Initial call to updateRunningTime to set the time immediately on load
            updateRunningTime();
            // Update time every second
            setInterval(updateRunningTime, 1000);
            /*  };*/


            let currentIndex = 0;
            const itemsToShow = 4;
            const totalItems = $('.leave-card').length;
            const itemWidth = $('.leave-card').outerWidth(true);

            function updateCarousel() {
                const offset = -currentIndex * itemWidth;
                $('.leave-row').css('transform', `translateX(${offset}px)`);
            }

            $('.carousel-control-next').click(function () {
                if (currentIndex < totalItems - itemsToShow) {
                    currentIndex++;
                    updateCarousel();
                }
            });

            $('.carousel-control-prev').click(function () {
                if (currentIndex > 0) {
                    currentIndex--;
                    updateCarousel();
                }
            });

            updateCarousel();

            $('.isempdashboardloaded').text('true');
        }



        //leave slider script
        $(document).ready(function () {
            $('#recipeCarousel').carousel({
                interval: 10000
            });

            // Handle the clone of carousel items for smoother transition
            $('.carousel .carousel-item').each(function () {
                var minPerSlide = 4;
                var next = $(this).next();

                if (!next.length) {
                    next = $(this).siblings(':first');
                }

                for (var i = 0; i < minPerSlide; i++) {
                    if (!next.length) {
                        next = $(this).siblings(':first');
                    }

                    next.children(':first-child').clone().appendTo($(this));
                    next = next.next();
                }
            });
            $('#recipeCarousel').on('slide.bs.carousel', function () {
                $(this).find('.carousel-inner').css('transition', 'transform 0.5s ease-in-out');
            });

            // Reset transition after the slide event completes
            $('#recipeCarousel').on('slid.bs.carousel', function () {
                $(this).find('.carousel-inner').css('transition', '');
            });
        });
    </script>
</div>

