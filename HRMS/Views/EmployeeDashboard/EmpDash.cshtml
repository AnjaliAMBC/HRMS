@model HRMS.Models.Employee.EmpDashBoardModel
@using HRMS.Models

@{
    var loginID = 0;
    var buttonText = "Check-In";
    DateTime checkInTime = DateTime.MinValue;
    DateTime? checkOutTime = DateTime.MinValue;

    string starttimeWithAmPm = "";
    string endtimeWithAmPm = "";

    string lastCheckinDate = "";
    bool showCheckInButton = false;


    if (Model.empLastDayCheckInDetails != null && !Model.empLastDayCheckInDetails.IsSignedOutOnLastCheckInDate && Model.empLastDayCheckInDetails.LoginID != 0)
    {
        buttonText = "Check-Out";
        loginID = Model.empLastDayCheckInDetails.LoginID;

        checkInTime = Model.empLastDayCheckInDetails.SignInTime;
        checkOutTime = Model.empLastDayCheckInDetails.SignOutTime;

        lastCheckinDate = checkInTime.ToString("dd/MM/yyyy");
        starttimeWithAmPm = checkInTime.ToString("hh:mm tt", System.Globalization.CultureInfo.InvariantCulture);
        showCheckInButton = true;
    }

    var ButtonDisabled = "";

    if (Model.todayCheckInInfo != null && Model.todayCheckInInfo.login_id != 0)
    {
        loginID = Model.todayCheckInInfo.login_id;
        buttonText = "Check-Out";
        checkInTime = Model.todayCheckInInfo.Signin_Time;
        checkOutTime = Model.todayCheckInInfo.Signout_Time;

        if (checkOutTime != null && checkOutTime != DateTime.MinValue && Model.IsOnLeave == true)
        {
            buttonText = "Check-In";
            ButtonDisabled = "disabled";
        }

        starttimeWithAmPm = checkInTime.ToString("hh:mm tt", System.Globalization.CultureInfo.InvariantCulture);
        endtimeWithAmPm = checkOutTime?.ToString("hh:mm tt", System.Globalization.CultureInfo.InvariantCulture);
    }

    if (Model.IsOnLeave == true)
    {
        buttonText = "Check-In";
        if (Model.empLeaveInfo != null && (Model.empLeaveInfo.DayType == "halfDay" || Model.empLeaveInfo.DayType == ""))
        {
            ButtonDisabled = "";
        }
        else
        {
            ButtonDisabled = "disabled";
        }
    }

    var currentUserSession = Session["SiteContext"] as HRMS.Models.SiteContextModel;
}

@Html.Partial("_NavBar")
<div class="container-fluid emp-dashboard">
    @Html.Partial("_empsidemenu")
    <div class="main-content container-fluid" style="width: 84%">
        <div class="hiddenempdashboard"></div>
        <div class="container-fluid mt-2 pl-0 employeedash">
            <h4>Dashboard</h4>
            <div class="row mt-4">
                <div class="col-lg-4 col-md-6">
                    <div class="card mb-3 dashcard_style">
                        <div class="card-header text-dark">Check In / Check Out</div>
                        <div class="card-body chechin-body p-1 mt-3">
                            <div class="container-fluid ">
                                <div class="row">
                                    <div class="day-date-time p-0 pl-2 col-md-8 col-sm-8">
                                        <h5 id="dashday" class="mb-0"></h5> <!-- Display day here -->
                                        <div id="dashcurrentDate" class="time-input smalltext"></div> <!-- Replace input with div -->
                                        <div id="dashcurrentTime" class="current-time mb-2"></div> <!-- Replace input with div -->
                                    </div>
                                    <div class="in-out col-md-4 p-0 pr-1 col-sm-4">
                                        <div class="check-time d-flex flex-column">
                                            <span class="check-label smalltext mr-auto">Check In time</span>
                                            <div id="checkInTime" class="time-input mr-auto"><span style="font-size: small; display: none">@lastCheckinDate</span>@starttimeWithAmPm</div>
                                        </div>
                                        <div class="check-time mt-2 d-flex flex-column">
                                            <span class="check-label smalltext mr-auto">Check Out time</span>
                                            <div id="checkOutTime" class="time-input mr-auto">@endtimeWithAmPm</div> <!-- Replace input with div -->
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-8 col-sm-8">
                                        <div class="current-time-display text-center ">
                                            <div id="currentTime" class="current-time"></div>
                                        </div>
                                        <span class="showcheckinbuttonpostcheckout" style="display: none">@showCheckInButton</span>
                                        <div class="button-container text-left total-hours">
                                            <button class="btn btn-checkin" data-checkinid="@loginID" @ButtonDisabled>@buttonText</button>
                                        </div>
                                    </div>
                                    <div class="col-md-4 p-0 pr-1 col-sm-4">
                                        <div class="checkinhours ">
                                            <span class="totalhours smalltext">Total Hours</span>
                                            @{
                                                var totalCheckInhours = Model.totalCheckedInTime;
                                                var formattedCheckInTime = @checkInTime;
                                            }

                                            @if (!string.IsNullOrWhiteSpace(Model.totalCheckedInTime))
                                            {
                                                formattedCheckInTime = DateTime.MinValue;
                                            }
                                            @if (Model.totalCheckedInTime == "" && @Model.timerModel != null && @Model.timerModel.FormattedTime.ToString() != string.Empty)
                                            {
                                                totalCheckInhours = @Model.timerModel.FormattedTime.ToString();
                                            }
                                            <div id="checkinhoursminutes" data-signedindatetime="@formattedCheckInTime" style="color: palevioletred">@totalCheckInhours</div>
                                        </div>
                                    </div>
                                </div>
                            </div>




                        </div>
                    </div>
                    <div class="card mb-3 dashcard_style">
                        <div class="card-header text-dark">Job Referral</div>
                        <div class="card-body scrollbar p-3">
                            <div class="dashjob_description mb-3">
                                <h6 class="mb-0">Interior Designer</h6>
                                <small>Location: Bangalore | Posted on: 10/05/2024</small>
                            </div>
                            <div class="dashjob_description mb-3">
                                <h6 class="mb-0">Business Analyst </h6>
                                <small>Location: Madurai | Posted on: 10/05/2024</small>
                            </div>
                            <div class="dashjob_description mb-3">
                                <h6 class="mb-0">Jr. IT Recruiter</h6>
                                <small>Location: Madurai | Posted on: 10/05/2024</small>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 dashcard_style">
                        <div class="card-header text-black">My Tickets</div>
                        <div class="card-body scrollbar p-3 dashticket_description">
                            <p class="mb-0">System Not working <span class="badge badge-danger">High</span></p>
                            <p class="smalltext">Closed by Goutham Arunaigiri</p>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4 col-md-6">

                    <div class="card mb-3 dashcard_style">
                        <div class="card-header text-dark">Birthdays</div>
                        <div class="card-body scrollbar p-2 mt-2">
                            @if (!Model.Birthdays?.Any() ?? true)
                            {
                                <div class="d-flex flex-column align-items-center justify-content-center">
                                    <img src="~/Assets/Birthday.png" alt="No Birthdays" class="img-fluid mb-3" style="max-width: 133px;">
                                    <p class="text-muted">No birthdays today</p>
                                </div>
                            }
                            else
                            {
                                <ul class="list-unstyled">
                                    @foreach (var empBirthday in Model.Birthdays)
                                    {
                                        var empImageURl = System.Configuration.ConfigurationManager.AppSettings["EmpImagesFolder"] + "/" + empBirthday.imagePath;

                                        <li class="media">
                                            <img src="@empImageURl" class="mr-3 rounded-circle" alt="Avatar" style="width: 40px; height: 40px;">
                                            <div class="media-body dashbirthday_description">
                                                <h6 class="mt-1 mb-0 empname">@empBirthday.EmpName</h6>
                                                <p class="smalltext">@empBirthday.Designation</p>
                                            </div>
                                            <small style="display: none" class="empemail">@empBirthday.EmpEmail</small>
                                        </li>
                                    }
                                </ul>
                            }
                        </div>
                    </div>

                    <div class="card mb-3 dashcard_style">
                        <div class="card-header text-dark">Anniversaries</div>
                        <div class="card-body scrollbar p-1 mt-2">
                            @if (!Model.AnniversaryModel?.Any() ?? true)
                            {
                                <div class="d-flex flex-column align-items-center justify-content-center">
                                    <img src="~/Assets/WorkAnni.jpg" alt="No Birthdays" class="img-fluid mb-3" style="max-width: 135px;">
                                    <p class="text-muted">No anniversaries today.</p>
                                </div>
                            }
                            else
                            {

                                <ul class="list-unstyled">
                                    @foreach (var anniversary in Model.AnniversaryModel)
                                    {
                                        var birthdayEmpImageURL = System.Configuration.ConfigurationManager.AppSettings["EmpImagesFolder"] + "/" + anniversary.imagePath;

                                        <li class="media">
                                            <img src="@birthdayEmpImageURL" class="mr-3 rounded-circle" alt="Avatar" style="width: 40px; height: 40px;">
                                            <div class="media-body dashanniversary_description">
                                                <h6 class="mt-1 mb-0 empname">@anniversary.EmpName</h6>
                                                <p class="smalltext">@anniversary.Designation</p>
                                            </div>
                                            <small style="display: none" class="empemail">@anniversary.EmpEmail</small>
                                        </li>
                                    }
                                </ul>

                            }
                        </div>
                    </div>
                    <div class="card mb-3 dashcard_style">
                        <div class="card-header text-dark">Employee Handbook</div>
                        <div class="card-body scrollbar d-flex flex-column">
                            <!-- Note-taking section -->
                            <div class="form-group">
                                <label for="employeeNotes">Your Notes:</label>
                                <textarea class="form-control" id="employeeNotes" rows="3" placeholder="Write your notes here..." style=" height: 50px;"></textarea>
                            </div>
                            <div class="dashnotes_btn text-right">
                                <button class="btn btn-primary btn-sm mb-3 " id="saveNotes">Save Note</button>
                            </div>

                            <h5>Your Notes:</h5>
                            <ul class="list-group" id="notesList"></ul>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4 col-md-12">
                    <div class="card mb-3">

                        <div class="card-header calendar-header text-dark">
                            <div>
                                <i class="fas fa-chevron-left chevron-icon ml-4" onclick="prevMonth()"></i>
                            </div>
                            <div>
                                <h6 id="monthYear" class="mt-1"></h6>
                            </div>
                            <div>
                                <i class="fas fa-chevron-right chevron-icon mr-4" onclick="nextMonth()"></i>
                            </div>
                        </div>
                        <div class="card-body calendar-body p-0">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th scope="col">Sun</th>
                                        <th scope="col">Mon</th>
                                        <th scope="col">Tue</th>
                                        <th scope="col">Wed</th>
                                        <th scope="col">Thu</th>
                                        <th scope="col">Fri</th>
                                        <th scope="col">Sat</th>
                                    </tr>
                                </thead>
                                <tbody id="calendarBody"></tbody>
                            </table>
                        </div>
                    </div>

                    <div class="card mb-3 dashholiday_body">
                        <div class="card-header text-dark">Upcoming Holidays</div>
                        <div class="card-body scrollbar ">
                            <ul class="list-unstyled pl-0">
                                @foreach (HRMS.Models.EmployeeEvent.UpcomingHoliday holiday in @Model.UpcomingHolidays)
                                {
                                    if (@holiday.HolidayDate != DateTime.MinValue)
                                    {

                                        <li class="dashhoiday_description">
                                            <a>
                                                <h6 class="mb-0">@holiday.HolidayName</h6>
                                                <p class="smalltext">@holiday.HolidayDate.ToString("dd MMMM dddd")</p>
                                            </a>
                                        </li>


                                    }
                                }

                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-lg-8 col-md-12">
                    <div class="card mb-3 dashleaveslider">
                        <div class="box_topic pl-3 py-2">
                            Leaves
                        </div>
                        <div class="card-body box_body p-0">
                            <div class="container text-center my-0 leave-container p-0">
                                <div class="leaveslider-container">
                                    <div class="leaveslider-wrapper">

                                        @foreach (var leaveType in Model.LeavesTypeInfo.LeaveTypes)
                                        {

                                            foreach (var leave in leaveType.AvailableLeaves)
                                            {
                                                <div class="leaveslider-item">
                                                    <div class="card">
                                                        <div class="leave-icon @leave.DashBoardColorCode">@leave.ShortName</div>
                                                        <h6 class="leave-title">@leave.Type</h6>
                                                        <p class="leave-details">Available: @leave.Available.ToString().Replace(".00", "").Replace(".0", "")</p>
                                                        <p class="leave-details">Booked: @leave.Booked</p>
                                                    </div>
                                                </div>
                                            }

                                        }
                                    </div>
                                    <div class="leaveslider-control left" onclick="prevSlide()">
                                        <i class="fa-solid fa-chevron-left"></i>
                                    </div>
                                    <div class="leaveslider-control right" onclick="nextSlide()">
                                        <i class="fa-solid fa-chevron-right"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <span class="currentempname" style="display: none">@Model.EmpInfo.EmployeeName</span>
        </div>
    </div>
    @Html.Partial("_compoff", Model.Employees)
</div>
<script>
    let currentIndex = 0;

    function updateleaveslider() {
        const leavesliderWrapper = document.querySelector('.leaveslider-wrapper');
        const items = document.querySelectorAll('.leaveslider-item');
        const itemWidth = items[0].getBoundingClientRect().width;
        const totalItems = items.length;
        const visibleItems = Math.floor(document.querySelector('.leaveslider-container').clientWidth / itemWidth);

        if (currentIndex >= totalItems - visibleItems) {
            currentIndex = totalItems - visibleItems;
        }

        if (currentIndex < 0) {
            currentIndex = 0;
        }

        leavesliderWrapper.style.transform = `translateX(-${currentIndex * itemWidth}px)`;
    }

    function nextSlide() {
        currentIndex++;
        updateleaveslider();
    }

    function prevSlide() {
        currentIndex--;
        updateleaveslider();
    }

    window.addEventListener('resize', updateleaveslider);
    window.addEventListener('load', updateleaveslider);
</script>

