@model HRMS.Models.ITsupport.MaintananceModel


@Html.Partial("_NavBar")
@{
    ViewBag.Title = "Maintanance";
}
<style>
    /* Add a border and background color to the dropdown button */
    button.multiselect {
        border: 1px solid #ced4da; /* Default border color similar to other input fields */
        background-color: #fff; /* White background for the dropdown */
        border-radius: 4px; /* Rounded corners */
        padding: 8px 12px; /* Padding for the button */
        width: 100%; /* Full width */
        text-align: left; /* Align text to the left */
        box-shadow: none; /* Remove default button shadow */
    }

        /* Add hover effect to the dropdown button */
        button.multiselect:hover {
            border-color: #80bdff; /* Change border color on hover */
            background-color: #f8f9fa; /* Light background on hover */
        }

    /* Style the multiselect dropdown itself */
    ul.multiselect-container {
        border: 1px solid #ced4da; /* Border for the dropdown menu */
        border-radius: 4px; /* Rounded corners */
        max-height: 200px; /* Limit dropdown height */
        overflow-y: auto; /* Add scrolling when content overflows */
        background-color: #fff; /* White background for the dropdown list */
    }

    /* Remove border and background for the selected names section */
    #selectedNames {
        margin-top: 10px;
        padding: 0; /* Remove padding */
        background-color: transparent; /* No background color */
        font-size: 14px;
        color: #333;
    }

    #selectedNames {
        font-size: 14px;
        color: #333;
        margin-top: 10px;
    }

    .modal.left .modal-dialog,
    .modal.right .modal-dialog {
        position: fixed;
        margin: auto;
        width: 320px;
        height: 100%;
        -webkit-transform: translate3d(0%, 0, 0);
        -ms-transform: translate3d(0%, 0, 0);
        -o-transform: translate3d(0%, 0, 0);
        transform: translate3d(0%, 0, 0);
    }

    .modal.left .modal-content,
    .modal.right .modal-content {
        height: 100%;
        overflow-y: auto;
    }

    .modal.left .modal-body,
    .modal.right .modal-body {
        padding: 15px 15px 80px;
    }

    /*Right*/
    .modal.right.fade .modal-dialog {
        right: 0px;
        -webkit-transition: opacity 0.3s linear, right 0.3s ease-out;
        -moz-transition: opacity 0.3s linear, right 0.3s ease-out;
        -o-transition: opacity 0.3s linear, right 0.3s ease-out;
        transition: opacity 0.3s linear, right 0.3s ease-out;
    }

    .modal.right.fade.in .modal-dialog {
        right: 0;
    }

    .modal-dialog {
        margin: 5% auto;
    }

    .select2-results__option .wrap:before {
        font-family: fontAwesome;
        color: #999;
        content: "\f096";
        width: 25px;
        height: 25px;
        padding-right: 10px;
    }

    .select2-results__option[aria-selected=true] .wrap:before {
        content: "\f14a";
    }

    /* not required css */

    .select2-multiple, .select2-multiple2 {
        width: 50%
    }
</style>
<div class="container-fluid">
    <div class="hiddenadmindashboard" style="display: none"></div>
    @Html.Partial("_adminsidemenu")
    <div class="main-content container-fluid maintenanceinfo-tab" style="width: 84%">
        <div class="content admin-maintenanceinfo-container" style="margin-left: -10px; ">
            <div class="admin-maintenanceinfo-view">
                <div class="container-fluid">
                    <div class="container-fluid top admin-maintenanceinfoview">
                        <div class="row navbar align-items-center">
                            <!-- monthly column -->
                            <div class="col-lg-4 col-md-6 topic d-flex res-admin-title">
                                <h4 class="header mb-0 text-right">Monthly Maintenance</h4>
                            </div>
                            <!-- Search box -->
                            <div class="col-xl-2 col-lg-6 navbarl1 col-sm-12 col-md-7 res-admin-maintenanceinfo-search">
                            </div>
                            <div class="col-xl-6 col-lg-5 navbarl1 col-sm-12 col-md-9 res-admin-maintenanceinfo-header-right">
                                <div class="col-xl-2 col-lg-2 navbarl1 col-sm-5 col-xs-12 col-md-3 res-admin-maintenanceinfo-filter p-0">
                                    <div class="form-group res-maintenanceinfo p-0">
                                        <p class="advancetitle mb-0">Filters</p>
                                        <div class="toggle-button admin-maintenanceinfo-button ml-2">
                                            <button class="collapsedropdown collapsed btn" type="button" data-toggle="collapse" data-target="#res-maintenance-filter-popup" aria-expanded="false" aria-controls="demo">
                                                <i class="fa-solid fa-angle-down"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div id="res-maintenance-filter-popup" class="res-maintenance-filter-popup">
                                        <!-- Filter fields for year, month, and location -->
                                        <div class="maintenance-filter-header-title">Filter based on year, month and location</div>
                                        <div class="maintenance-filter-header-body">
                                            <div class="maintenance-filter-fileds maintenance-filter-year">
                                                <select class="form-control form-select" name="maintenance-filter-year-dropdown" id="maintenance-filter-year-dropdown">
                                                    <option value="" disabled selected>Select Year</option>
                                                    <option value="2023">2023</option>
                                                    <option value="2024">2024</option>
                                                    <option value="2025">2025</option>
                                                    <option value="2026">2026</option>
                                                    <option value="2027">2027</option>
                                                    <option value="2028">2028</option>
                                                </select>
                                            </div>
                                            <div class="maintenance-filter-fileds maintenance-filter-month">
                                                <select class="form-control form-select" name="maintenance-filter-month-dropdown" id="maintenance-filter-month-dropdown">
                                                    <option value="" disabled selected>Select Month</option>
                                                    <option value="1">Jan</option>
                                                    <option value="2">Feb</option>
                                                    <option value="3">Mar</option>
                                                    <option value="4">Apr</option>
                                                    <option value="5">May</option>
                                                    <option value="6">Jun</option>
                                                    <option value="7">Jul</option>
                                                    <option value="8">Aug</option>
                                                    <option value="9">Sep</option>
                                                    <option value="10">Oct</option>
                                                    <option value="11">Nov</option>
                                                    <option value="12">Dec</option>
                                                </select>
                                            </div>
                                            <div class="maintenance-filter-fileds maintenance-filter-location">
                                                <select class="form-control form-select" name="maintenance-filter-location-dropdown" id="maintenance-filter-location-dropdown">
                                                    <option value="" disabled selected>Select Location</option>
                                                    <option value="Hyderabad">Hyderabad</option>
                                                    <option value="Madurai">Madurai</option>
                                                    <option value="All">All</option>
                                                </select>
                                            </div>
                                            <div class="form-group align-items-center res-maintenance-filter-submit mr-2">
                                                <button type="button" class="btn btn-sm btn-primary maintenance-filter-view">View</button>
                                                <button type="button" class="btn btn-sm btn-primary maintenance-filter-export">Export</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Add monthly btn -->
                                <div class="col-lg-5 navbarl1 col-sm-6 col-md-7 res-admin-maintenanceinfo-add text-right">
                                    <div class="addingmaintenanceinfo form-group">
                                        <button name="addmaintenanceinfo" class="addmaintenanceinfo btn" id="addmaintenanceinfo" data-toggle="modal" data-target="#addmaintenanceinfo-popup">
                                            Schedule Maintenance
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    @Html.Partial("~/Views/Itsupport/_maintenanceinfotable.cshtml", Model)

                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal right fade" id="RescheduleMaintenancePopup" tabindex="-1" role="dialog" aria-labelledby="RescheduleMaintenancePopup">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="reschedulemaintenance-header-title">Reschedule Maintenance</h4>
                @*<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>*@
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><i class="fa fa-times-circle" aria-hidden="true"></i></button>
            </div>
            <div class="modal-body">
                <div class="reschedulemaintenance-body-title">
                    <span class="reschedulemaintenance-image-btn"><img src="" alt="ename"></span><span class="reschedulemaintenance-id-select" data-assetid="name">Name</span>
                </div>
                <div class="maintenanceapprove-info">
                    <div class="row">
                        <div class="col-lg-12 col-md-12">
                            <div class="form-group maintenanceapproved-tabs">
                                <label for="RescheduleMaintenance-Date">Maintenance Date</label>
                                <input type="date" class="form-control" id="RescheduleMaintenance-Date" value="" readonly>
                            </div>
                        </div>
                        <div class="col-lg-12 col-md-12">
                            <div class="form-group reschedulemaintenance-tabs">
                                <label for="RescheduleMaintenance-AgentName">Agent Name</label>
                                <select name="RescheduleMaintenance-AgentName" class="RescheduleMaintenance-AgentName form-control form-select" id="RescheduleMaintenance-AgentName">
                                    <option value="" disabled selected hidden>Select Agent</option>
                                    @foreach (var agent in Model.ITEmployees)
                                    {
                                        <option value="@agent.EmployeeID">@agent.EmployeeName</option>
                                    }

                                </select>
                            </div>
                        </div>
                        <div class="col-lg-12 col-md-12">
                            <div class="form-group reschedulemaintenance-tabs">
                                <label for="RescheduleMaintenance-Reschedule">Reschedule Date</label>
                                <input type="date" class="form-control" id="RescheduleMaintenance-Reschedule" value="">
                            </div>
                        </div>
                        <div class="col-lg-12 col-md-12">
                            <div class="form-group reschedulemaintenance-tabs">
                                <label for="RescheduleMaintenance-Notes">Notes</label>
                                <textarea rows="3" class="form-control" id="RescheduleMaintenance-Notes" name="RescheduleMaintenance-Notes"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-12 col-md-12 text-right">
                            <button type="button" class="btn btn-primary reschedulemaintenance-Update" data-maintenancesno="">Reschedule</button>
                        </div>
                        <div class="col-lg-12 col-md-12 text-right">
                            <!-- Message div for showing success or failure message -->
                            <div id="MaintenancemodalMessage" class="mt-2" style="display:none;"></div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <!-- modal-content -->
    </div>
    <!-- modal-dialog -->
</div>
<!-- modal -->

<div class="modal fade" id="addmaintenanceinfo-popup" tabindex="-1" role="dialog" aria-labelledby="addmaintenanceinfo-popup" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <div class="addmaintenanceinfo-header-title">Schedule Maintenance</div>
                <div class="schedulemaintenance-popup-info">
                    <div class="row">
                        <div class="col-lg-12 col-md-12">
                            <div class="form-group schedulemaintenance-tabs">
                                <label class="form-check-label schedulemaintenance-radio1" for="schedulemaintenance-radio1">
                                    <input type="radio" class="form-check-input" id="schedulemaintenance-radio1" name="schedulemaintenance-location" value="Madurai" checked>Madurai
                                </label>
                                <label class="form-check-label schedulemaintenance-radio2" for="schedulemaintenance-radio2">
                                    <input type="radio" class="form-check-input" id="schedulemaintenance-radio2" name="schedulemaintenance-location" value="Hyderabad">Hyderabad
                                </label>
                            </div>
                        </div>
                        <div class="col-lg-12 col-md-12">
                            <div class="form-group schedulemaintenance-tabs">
                                <label for="multiSelectDropdown">Employees</label>
                                <select id="multiSelectDropdown" class="form-control" multiple="multiple">

                                    @foreach (var emp in Model.Employees)
                                    {
                                        <option data-empemailid="@emp.OfficalEmailid" data-empname="@emp.EmployeeName" value="@emp.EmployeeID">@emp.EmployeeName @emp.EmployeeID</option>

                                    }
                                </select>

                                <div id="selectedNames" class="mt-2 text-muted"></div>

                            </div>
                        </div>
                        <div class="col-lg-12 col-md-12">
                            <div class="form-group schedulemaintenance-tabs">
                                <label for="ScheduleMaintenance-Agent">Agent</label>
                                <select name="ScheduleMaintenance-Agent" class="ScheduleMaintenance-Employee form-control form-select" id="ScheduleMaintenance-Agent">
                                    <option value="" disabled selected hidden>Select Agent</option>
                                    @foreach (var employee in Model.ITEmployees)
                                    {
                                        <option value="@employee.EmployeeID">@employee.EmployeeName</option>
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="col-lg-12 col-md-12">
                            <div class="form-group schedulemaintenance-tabs">
                                <label for="ScheduleMaintenance-Date">Date</label>
                                <input type="date" class="form-control" id="ScheduleMaintenance-Date" value="">
                            </div>
                        </div>

                        <div class="col-lg-12 col-md-12">
                            <div class="row">
                                <div class="col-lg-6 col-md-12">
                                    <div class="form-group schedulemaintenance-tabs">
                                        <label for="time">Time In</label>
                                        <div class="input-group date">
                                            <input type="text" class="form-control datetimepicker-input" id="datetimepicker1" data-toggle="datetimepicker" data-target="#datetimepicker1" placeholder="Pick Time In" />
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-12">
                                    <div class="form-group schedulemaintenance-tabs">
                                        <label for="time">Time Out</label>
                                        <div class="input-group date">
                                            <input type="text" class="form-control datetimepicker-input" id="datetimepicker2" data-toggle="datetimepicker" data-target="#datetimepicker2" placeholder="Pick Time Out" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn refresh-emptablist" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary Add-Schedule-Maintanance">Submit</button>
                    <span id="maintenanceMessage" class="ml-3" style="display:none;"></span>
                </div>
            </div>
        </div>
    </div>
</div>
<link href="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/js/tempusdominus-bootstrap-4.min.js"></script>
<script src="~/Scripts/Z-Maintanance.js"></script>

<script>






    $('input[name="schedulemaintenance-location"]').on('change', function () {
        var selectedLocation = $(this).val(); // Get the value of the selected radio button

        // Show all options first
        $('#multiSelectDropdown option').show();

        // Hide options that do not match the selected location
        $('#multiSelectDropdown option').filter(function () {
            return $(this).data('emplocation') !== selectedLocation; // Use data-emplocation attribute for filtering
        }).hide();
    });





    $(function () {
        $('#datetimepicker1').datetimepicker({
            format: 'HH:mm'
        });
        $('#datetimepicker2').datetimepicker({
            format: 'HH:mm'
        });
    });

    function toggleMaintenanceActionOptions(iconElement) {
        const optionsMenu = $(iconElement).next('.maintenance-options');
        $('.maintenance-options').not(optionsMenu).hide();
        optionsMenu.toggle();
    }

    $('#multiSelectDropdown').multiselect({
        includeSelectAllOption: true,  // Option to select all
        enableFiltering: true,         // Enables search filter
        buttonWidth: '100%',           // Make the button full width
        nonSelectedText: 'Select Employees', // Placeholder text
        enableCaseInsensitiveFiltering: true, // Case insensitive search
        maxHeight: 200,                // Dropdown max height
        numberDisplayed: 0,            // Do not display any selected item in the button
        buttonText: function (options, select) {
            // Always show the placeholder text and hide selected names in input
            if (options.length === 0) {
                return 'Select Employees';
            } else {
                return 'Employees Selected';
            }
        },
        onChange: function (option, checked) {
            updateSelectedNames();  // Update names when an option is changed
        },
        onSelectAll: function () {
            updateSelectedNames();  // Update names when "Select All" is used
        },
        onDeselectAll: function () {
            updateSelectedNames();  // Update names when "Deselect All" is used
        }
    });

    // Function to update the selected names below the input field
    function updateSelectedNames() {
        var selectedOptions = $('#multiSelectDropdown option:selected');  // Get all selected options
        var selectedText = [];

        selectedOptions.each(function () {
            selectedText.push($(this).text());  // Extract text of each selected option
        });

        // Display the selected names below the input field
        if (selectedText.length > 0) {
            $('#selectedNames').html('Selected Employees: ' + selectedText.join(', '));
        } else {
            $('#selectedNames').html('No employees selected');
        }
    }

    jQuery(function ($) {
        $.fn.select2.amd.require([
            'select2/selection/single',
            'select2/selection/placeholder',
            'select2/selection/allowClear',
            'select2/dropdown',
            'select2/dropdown/search',
            'select2/dropdown/attachBody',
            'select2/utils'
        ], function (SingleSelection, Placeholder, AllowClear, Dropdown, DropdownSearch, AttachBody, Utils) {

            var SelectionAdapter = Utils.Decorate(
                SingleSelection,
                Placeholder
            );

            SelectionAdapter = Utils.Decorate(
                SelectionAdapter,
                AllowClear
            );

            var DropdownAdapter = Utils.Decorate(
                Utils.Decorate(
                    Dropdown,
                    DropdownSearch
                ),
                AttachBody
            );

            var base_element = $('.select2-multiple2')
            $(base_element).select2({
                placeholder: 'Select multiple items',
                selectionAdapter: SelectionAdapter,
                dropdownAdapter: DropdownAdapter,
                allowClear: true,
                templateResult: function (data) {

                    if (!data.id) { return data.text; }

                    var $res = $('<div></div>');

                    $res.text(data.text);
                    $res.addClass('wrap');

                    return $res;
                },
                templateSelection: function (data) {
                    if (!data.id) { return data.text; }
                    var selected = ($(base_element).val() || []).length;
                    var total = $('option', $(base_element)).length;
                    return "Selected " + selected + " of " + total;
                }
            })

        });

    });

</script>

