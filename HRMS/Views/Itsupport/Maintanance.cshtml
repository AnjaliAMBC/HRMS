@model HRMS.Models.ITsupport.MaintananceModel


@Html.Partial("_NavBar")
@{
    ViewBag.Title = "Maintanance";
}
<style>
    /* Add a border and background color to the dropdown button */
    button.multiselect {
        border: 1px solid #ced4da; /* Default border color similar to other input fields */
        background-color: #fff; /* White background for the dropdown */
        border-radius: 4px; /* Rounded corners */
        padding: 8px 12px; /* Padding for the button */
        width: 100%; /* Full width */
        text-align: left; /* Align text to the left */
        box-shadow: none; /* Remove default button shadow */
    }

        /* Add hover effect to the dropdown button */
        button.multiselect:hover {
            border-color: #80bdff; /* Change border color on hover */
            background-color: #f8f9fa; /* Light background on hover */
        }

    /* Style the multiselect dropdown itself */
    ul.multiselect-container {
        border: 1px solid #ced4da; /* Border for the dropdown menu */
        border-radius: 4px; /* Rounded corners */
        max-height: 200px; /* Limit dropdown height */
        overflow-y: auto; /* Add scrolling when content overflows */
        background-color: #fff; /* White background for the dropdown list */
    }

    /* Remove border and background for the selected names section */
    #selectedNames {
        margin-top: 10px;
        padding: 0; /* Remove padding */
        background-color: transparent; /* No background color */
        font-size: 14px;
        color: #333;
    }

    #selectedNames {
        font-size: 14px;
        color: #333;
        margin-top: 10px;
    }
</style>
<div class="container-fluid">
    <div class="hiddenadmindashboard" style="display: none"></div>
    @Html.Partial("_adminsidemenu")
    <div class="main-content container-fluid maintenanceinfo-tab" style="width: 84%">
        <div class="content admin-maintenanceinfo-container" style="margin-left: -10px; ">
            <div class="admin-maintenanceinfo-view">
                <div class="container-fluid">
                    <div class="container-fluid top admin-maintenanceinfoview">
                        <div class="row navbar align-items-center">
                            <!-- asset column -->
                            <div class="col-lg-3 col-md-5 topic d-flex res-admin-title">
                                <h4 class="header mb-0 text-right">Monthly Maintenance</h4>
                            </div>
                            <!-- Search box -->
                            <div class="col-xl-3 col-lg-6 navbarl1 col-sm-12 col-md-7 res-admin-maintenanceinfo-search">
                            </div>
                            <div class="col-xl-6 col-lg-5 navbarl1 col-sm-12 col-md-8 res-admin-maintenanceinfo-header-right">
                                <div class="col-xl-2 col-lg-2 navbarl1 col-sm-5 col-xs-12 col-md-4 res-admin-maintenanceinfo-filter p-0">
                                    <div class="form-group res-maintenanceinfo p-0">
                                        <p class="advancetitle mb-0">Filters</p>
                                        <div class="toggle-button admin-maintenanceinfo-button ml-2">
                                            <button class="collapsedropdown collapsed btn" type="button" data-toggle="collapse" data-target="#res-maintenance-filter-popup" aria-expanded="false" aria-controls="demo">
                                                <i class="fa-solid fa-angle-down"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div id="res-maintenance-filter-popup" class="res-maintenance-filter-popup">
                                        <div class="maintenance-filter-header-title">Filter based on year, month and location</div>
                                        <div class="maintenance-filter-header-body">
                                            <div class="maintenance-filter-fileds maintenance-filter-year">
                                                <select class="form-control form-select" name="maintenance-filter-year-dropdown" id="maintenance-filter-year-dropdown">
                                                    <option value="" disabled selected>2024</option>
                                                    <option value="2025">2025</option>
                                                </select>
                                            </div>
                                            <div class="maintenance-filter-fileds maintenance-filter-month">
                                                <select class="form-control form-select" name="maintenance-filter-month-dropdown" id="maintenance-filter-month-dropdown">
                                                    <option value="" disabled selected>Jan</option>
                                                    <option value="Feb">Feb</option>
                                                </select>
                                            </div>
                                            <div class="maintenance-filter-fileds maintenance-filter-date">
                                                <select class="form-control form-select" name="maintenance-filter-date-dropdown" id="maintenance-filter-date-dropdown">
                                                    <option value="" disabled selected>All</option>
                                                    <option value="1">1</option>
                                                </select>
                                            </div>
                                            <div class="form-group align-items-center res-maintenance-filter-submit mr-2">
                                                <button type="button" class="btn btn-sm btn-primary maintenance-filter-view">View</button>
                                                <button type="button" class="btn btn-sm btn-primary  maintenance-filter-export">Export</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Add asset dropdown -->
                                <div class="col-lg-6 navbarl1 col-sm-6 col-md-6 res-admin-maintenanceinfo-add text-right">
                                    <div class="addingmaintenanceinfo form-group">
                                        <button name="addsubscriptioninfo" class="addmaintenanceinfo btn" id="addmaintenanceinfo" data-toggle="modal" data-target="#addmaintenanceinfo-popup">
                                            Schedule Maintenance
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="res-admin-maintenanceinfo-table table-responsive">
                        <table id="adminmaintenanceinfotable" class="display" style="width: 100%;">
                            <thead style="background-color: #d8e6fb; border-radius: 10px;">
                                <tr>
                                    <th>Employee Name</th>
                                    <th>Maintenance Date</th>
                                    <th>Reschedule</th>
                                    <th>Agent Name</th>
                                    <th>Status</th>
                                    <th>Notes</th>
                                    <th style="text-align:center;">Acknowledge</th>
                                    <th style="text-align:center;">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="odd">
                                    <td class="tdmaintenance-ename"><span class="maintenanceinfo-image-btn"><img src="~/Assets/EmpImages/1155.jpeg" alt="ename"></span><span class="maintenance-id-select" data-assetid="name">Name</span></td>
                                    <td>01 October 2024</td>
                                    <td class="tdmaintenancereschedule">01 October 2024</td>
                                    <td><span class="maintenanceinfo-image-btn"><img src="~/Assets/EmpImages/1155.jpeg" alt="agentname"></span><span class="maintenance-id-select" data-assetid="name">Name</span></td>
                                    <td><div class="maintenance-status completed">Completed</div></td>
                                    <td>-</td>
                                    <td class="maintenancestatus-icon">
                                        <span class="maintenanceapproved-btn">
                                            <img src="/assets/Approve.png" alt="Approved" style="width:25px" title="Approved by Mithun Sivaprakasam">
                                            <div style="display:none">Approved</div>
                                        </span>
                                    </td>
                                    <td style="text-align:center;">
                                        <span class="maintenanceinfo-list-edit">
                                            <i class="fas fa-ellipsis-v asset-edit-dropdown" onclick="toggleMaintenanceActionOptions(this)"></i>
                                            <div class="maintenance-options" style="display:none">
                                                <a class="dropdown-item maintenance-info-view" data-assetid="1">View</a>
                                                <a class="dropdown-item maintenance-info-reschedule" data-assetid="1">Reschedule</a>
                                            </div>
                                        </span>
                                    </td>
                                </tr>
                                <tr class="even">
                                    <td class="tdmaintenance-ename"><span class="maintenanceinfo-image-btn"><img src="~/Assets/EmpImages/1155.jpeg" alt="ename"></span><span class="maintenance-id-select" data-assetid="name">Name</span></td>
                                    <td>01 October 2024</td>
                                    <td class="tdmaintenancereschedule">01 October 2024</td>
                                    <td><span class="maintenanceinfo-image-btn"><img src="~/Assets/EmpImages/1155.jpeg" alt="agentname"></span><span class="maintenance-id-select" data-assetid="name">Name</span></td>
                                    <td><div class="maintenance-status pending">Pending</div></td>
                                    <td>-</td>
                                    <td class="maintenancestatus-icon">
                                        <span class="maintenanceapproved-btn">
                                            <img src="/assets/Pending.png" alt="Approved" style="width:25px" title="Pending">
                                            <div style="display:none">Approved</div>
                                        </span>
                                    </td>
                                    <td style="text-align:center;">
                                        <span class="maintenanceinfo-list-edit">
                                            <i class="fas fa-ellipsis-v asset-edit-dropdown" onclick="toggleMaintenanceActionOptions(this)"></i>
                                            <div class="maintenance-options" style="display:none">
                                                <a class="dropdown-item maintenance-info-view" data-assetid="1">View</a>
                                                <a class="dropdown-item maintenance-info-edit" data-assetid="1">Reschedule</a>
                                            </div>
                                        </span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="addmaintenanceinfo-popup" tabindex="-1" role="dialog" aria-labelledby="addmaintenanceinfo-popup" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <div class="addmaintenanceinfo-header-title">Schedule Maintenance</div>
                <div class="schedulemaintenance-popup-info">
                    <div class="row">
                        <div class="col-lg-12 col-md-12">
                            <div class="form-group schedulemaintenance-tabs">
                                <label class="form-check-label schedulemaintenance-radio1" for="schedulemaintenance-radio1">
                                    <input type="radio" class="form-check-input" id="schedulemaintenance-radio1" name="schedulemaintenance-location" value="Madurai" checked>Madurai
                                </label>
                                <label class="form-check-label schedulemaintenance-radio2" for="schedulemaintenance-radio2">
                                    <input type="radio" class="form-check-input" id="schedulemaintenance-radio2" name="schedulemaintenance-location" value="Hyderabad">Hyderabad
                                </label>
                            </div>
                        </div>
                        <div class="col-lg-12 col-md-12">
                            <div class="form-group schedulemaintenance-tabs">
                                <label for="multiSelectDropdown">Select Employees</label>
                                <select id="multiSelectDropdown" class="form-control" multiple="multiple">
                                    <option value="">Select Employees</option>
                                    @foreach (var emp in Model.Employees)
                                    {
                                        <option data-emplocation="@emp.Location" data-empname="@emp.EmployeeName" value="@emp.EmployeeID">@emp.EmployeeName @emp.EmployeeID</option>

                                    }
                                </select>
                                <!-- Display the selected names below the input field -->
                                <div id="selectedNames" class="mt-2 text-muted"></div>

                            </div>
                        </div>
                        <div class="col-lg-12 col-md-12">
                            <div class="form-group schedulemaintenance-tabs">
                                <label for="ScheduleMaintenance-Agent">Agent</label>
                                <select name="ScheduleMaintenance-Agent" class="ScheduleMaintenance-Employee form-control form-select" id="ScheduleMaintenance-Agent">
                                    <option value="" disabled selected hidden>Select Agent</option>
                                    <option value="Test Name">Test Name</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-lg-12 col-md-12">
                            <div class="form-group schedulemaintenance-tabs">
                                <label for="ScheduleMaintenance-Date">Date</label>
                                <input type="date" class="form-control" id="ScheduleMaintenance-Date" value="">
                            </div>
                        </div>

                        <div class="col-lg-12 col-md-12">
                            <div class="row">
                                <div class="col-lg-6 col-md-12">
                                    <div class="form-group schedulemaintenance-tabs">
                                        <label for="time">Time In</label>
                                        <div class="input-group date">
                                            <input type="text" class="form-control datetimepicker-input" id="datetimepicker1" data-toggle="datetimepicker" data-target="#datetimepicker1" placeholder="Pick Time In" />
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-12">
                                    <div class="form-group schedulemaintenance-tabs">
                                        <label for="time">Time Out</label>
                                        <div class="input-group date">
                                            <input type="text" class="form-control datetimepicker-input" id="datetimepicker2" data-toggle="datetimepicker" data-target="#datetimepicker2" placeholder="Pick Time Out" />
                                        </div>
                                    </div>
                                </div>

                            </div>


                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn refresh-emptablist" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary delete-Subscription">Submit</button>
                </div>
            </div>
        </div>
    </div>
</div>
<link href="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/js/tempusdominus-bootstrap-4.min.js"></script>
<script src="~/Scripts/Z-Maintanance.js"></script>

<script>
    $(document).ready(function () {
        if (!$.fn.DataTable.isDataTable('#adminmaintenanceinfotable')) {
            var table = $('#adminmaintenanceinfotable').DataTable({
                "responsive": true,
                "paging": true,
                "searching": false,
                "ordering": false,
                "info": true,
                "autoWidth": false,
                "lengthMenu": [[10, 20, 50, -1], [10, 20, 50, "All"]]
            });
        }
    });






    $('input[name="schedulemaintenance-location"]').on('change', function () {
        var selectedLocation = $(this).val(); // Get the value of the selected radio button

        // Show all options first
        $('#multiSelectDropdown option').show();

        // Hide options that do not match the selected location
        $('#multiSelectDropdown option').filter(function () {
            return $(this).data('emplocation') !== selectedLocation; // Use data-emplocation attribute for filtering
        }).hide();
    });





    $(function () {
        $('#datetimepicker1').datetimepicker({
            format: 'HH:mm'
        });
        $('#datetimepicker2').datetimepicker({
            format: 'HH:mm'
        });
    });

    function toggleMaintenanceActionOptions(iconElement) {
        const optionsMenu = $(iconElement).next('.maintenance-options');
        $('.maintenance-options').not(optionsMenu).hide();
        optionsMenu.toggle();
    }

    $('#multiSelectDropdown').multiselect({
        includeSelectAllOption: true,  // Option to select all
        enableFiltering: true,         // Enables search filter
        buttonWidth: '100%',           // Make the button full width
        nonSelectedText: 'Select Employees', // Placeholder text
        enableCaseInsensitiveFiltering: true, // Case insensitive search
        maxHeight: 200,                // Dropdown max height
        numberDisplayed: 0,            // Do not display any selected item in the button
        buttonText: function (options, select) {
            // Always show the placeholder text and hide selected names in input
            if (options.length === 0) {
                return 'Select Employees';
            } else {
                return 'Employees Selected';
            }
        },
        onChange: function (option, checked) {
            updateSelectedNames();  // Update names when an option is changed
        },
        onSelectAll: function () {
            updateSelectedNames();  // Update names when "Select All" is used
        },
        onDeselectAll: function () {
            updateSelectedNames();  // Update names when "Deselect All" is used
        }
    });

    // Function to update the selected names below the input field
    function updateSelectedNames() {
        var selectedOptions = $('#multiSelectDropdown option:selected');  // Get all selected options
        var selectedText = [];

        selectedOptions.each(function () {
            selectedText.push($(this).text());  // Extract text of each selected option
        });

        // Display the selected names below the input field
        if (selectedText.length > 0) {
            $('#selectedNames').html('Selected Employees: ' + selectedText.join(', '));
        } else {
            $('#selectedNames').html('No employees selected');
        }
    }
</script>

