@model HRMS.Models.Timesheet
@{
    var dateFromUrl = Request.QueryString["date"];
}

<div class="emp-entertimesheet-block1">
    <span class="emp-entertimesheet-weekno" id="week-number">Week @Model.Weeknumber</span>
    <span class="emp-entertimesheet-weekrange-info">
        <i class="fa fa-angle-left" aria-hidden="true" id="prev-week"></i>
        <span class="emp-entertimesheet-weekrange">
            <span id="week-start">@Model.WeekStartDate.ToString("dd MMMM yyyy")</span>
            <i class="fa fa-long-arrow-right" aria-hidden="true"></i>
            <span id="week-end">@Model.WeekEndDate.ToString("dd MMMM yyyy")</span>
        </span>
        <i class="fa fa-angle-right" aria-hidden="true" id="next-week"></i>
    </span>
</div>

<div class="emp-entertimesheet-block2">
    <div class="emp-entertimesheet-rangedates">
        @{
            int index = 1;

        }
        @foreach (var date in Model.WeekInfo)
        {
            var hrefbloackNumber = "emp-entertimesheet-day-block" + index;
            var idNumber = "date-" + index;
            var activeClass = "";
            var datecolor = "";

            if (dateFromUrl != null && date.Date.ToString("dd-MM-yyyy") == dateFromUrl)
            {
                activeClass = "active";
            }
            else if (dateFromUrl == null && index == 1)
            {
                activeClass = "active";
            }

            if (date.IsWeekend)
            {
                datecolor = "background-color:lightgray";
            }

            <span class="@activeClass" style="@datecolor" href="#@hrefbloackNumber" id="@idNumber">
                @date.Date.ToString("dd-MM-yyyy")
            </span>

            index = index + 1;
        }
    </div>

</div>

<div class="emp-entertimesheet-block3">
    <div class="form-group div-entertimesheet-clientname">
        <label for="entertimesheetClientName" class="leave_label">Client*</label>
        <select class="form-control selected-timesheet-client" id="entertimesheetClientName" disabled>
            @foreach (var client in Model.SiteContext.EmpBasedClients)
            {
                <option value="@client.Client">@client.Client</option>
            }

        </select>
        <span class="error-message" id="entertimesheetClientName-error"></span>
    </div>
</div>

<div class="selected-timesheet-client" style="display: none">@Model.Client</div>

<div class="emp-entertimesheet-block4">
    @{
        int dayindex = 1;
    }
    @foreach (var dayInfo in Model.WeekInfo)
    {
        var blockNumber = "emp-entertimesheet-day-block" + dayindex;
        var activeClass = "";
        var display = "display:none;";

        if (dateFromUrl != null && dayInfo.Date.ToString("dd-MM-yyyy") == dateFromUrl)
        {
            activeClass = "active";
            display = "display:block;";
        }

        else if (dateFromUrl == null && dayindex == 1)
        {
            activeClass = "active";
            display = "display:block;";
        }

        var dayModel = new HRMS.Models.TimesheetDayModel();
        dayModel.IndexNumber = dayindex;
        dayModel.Weeknumber = Model.Weeknumber;
        dayModel.Date = dayInfo.Date;
        dayModel.BlockNumber = blockNumber;
        dayModel.StartIndexNumber = 1;
        dayModel.EndIndexNumber = 5;
        dayModel.DaySpecifcInfo = dayInfo;

        <div id="@blockNumber" class="@blockNumber @activeClass" style="@display">
            @Html.Partial("~/Views/Timesheet/_TimesheetRows.cshtml", dayModel)
        </div>

        dayindex = dayindex + 1;
    }
</div>


<script>
    $(document).ready(function () {
        const urlParams = new URLSearchParams(window.location.search);
        const client = urlParams.get('client');
        if (client) {
            $('#entertimesheetClientName').val(client);
        }
    });
</script>
